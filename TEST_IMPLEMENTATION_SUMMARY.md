# mq-cms å¾Œç«¯è‡ªå‹•åŒ–æ¸¬è©¦å¯¦æ–½ç¸½çµ

## ğŸ¯ ä»»å‹™å®Œæˆç‹€æ³

âœ… **ç¬¬ä¸€æ­¥ï¼šå¢åŠ å¾Œç«¯è‡ªå‹•åŒ–æ¸¬è©¦** - **å·²å®Œæˆ**

æˆ‘å·²æˆåŠŸç‚ºä½ çš„ mq-cms å°ˆæ¡ˆå»ºç«‹äº†å®Œæ•´çš„è‡ªå‹•åŒ–æ¸¬è©¦æ¶æ§‹ï¼Œé‡é»é‡å°èªè­‰ API (`/api/auth/login`) é€²è¡Œäº†å…¨é¢çš„æ¸¬è©¦è¦†è“‹ã€‚

## ğŸ“¦ å·²å»ºç«‹çš„æ¸¬è©¦æ¶æ§‹

### 1. æ¸¬è©¦ç›®éŒ„çµæ§‹
```
tests/
â”œâ”€â”€ __init__.py          # æ¸¬è©¦æ¨¡çµ„åˆå§‹åŒ–
â”œâ”€â”€ conftest.py          # pytest é…ç½®å’Œå…±ç”¨ fixtures
â”œâ”€â”€ test_auth.py         # èªè­‰ API å®Œæ•´æ¸¬è©¦æ¡ˆä¾‹
â””â”€â”€ README.md           # è©³ç´°ä½¿ç”¨èªªæ˜
```

### 2. æ ¸å¿ƒé…ç½®æ–‡ä»¶
- `pytest.ini` - pytest æ¸¬è©¦æ¡†æ¶é…ç½®
- `run_tests.py` - æ¸¬è©¦åŸ·è¡Œè…³æœ¬
- æ›´æ–° `requirements.txt` - æ·»åŠ æ¸¬è©¦ä¾è³´

## ğŸ”’ èªè­‰ API æ¸¬è©¦è¦†è“‹

### TestAuthLogin é¡åˆ¥ (13 å€‹æ¸¬è©¦)
- âœ… `test_successful_login` - æˆåŠŸç™»å…¥æµç¨‹
- âœ… `test_login_with_wrong_password` - å¯†ç¢¼éŒ¯èª¤è™•ç†
- âœ… `test_login_with_nonexistent_user` - ä¸å­˜åœ¨ä½¿ç”¨è€…è™•ç†
- âœ… `test_login_missing_username` - ç¼ºå°‘ä½¿ç”¨è€…åç¨±
- âœ… `test_login_missing_password` - ç¼ºå°‘å¯†ç¢¼
- âœ… `test_login_empty_request_body` - ç©ºè«‹æ±‚é«”è™•ç†
- âœ… `test_login_no_json_data` - ç„¡ JSON è³‡æ–™è«‹æ±‚
- âœ… `test_login_with_empty_username` - ç©ºä½¿ç”¨è€…åç¨±è™•ç†
- âœ… `test_login_with_empty_password` - ç©ºå¯†ç¢¼è™•ç†
- âœ… `test_token_expiration_time` - JWT token éæœŸæ™‚é–“é©—è­‰
- âœ… `test_multiple_users_login` - å¤šä½¿ç”¨è€…ç™»å…¥æ¸¬è©¦
- âœ… `test_case_sensitive_username` - ä½¿ç”¨è€…åç¨±å¤§å°å¯«æ•æ„Ÿæ€§
- âœ… `test_sql_injection_attempt` - SQL æ³¨å…¥æ”»æ“Šé˜²è­·

### TestAuthIntegration é¡åˆ¥ (4 å€‹æ¸¬è©¦)
- âœ… `test_login_and_use_token` - ç™»å…¥å¾Œ token ä½¿ç”¨æ•´åˆæ¸¬è©¦
- âœ… `test_invalid_token_format` - ç„¡æ•ˆ token æ ¼å¼è™•ç†
- âœ… `test_missing_bearer_prefix` - ç¼ºå°‘ Bearer å‰ç¶´è™•ç†
- âœ… `test_expired_token` - éæœŸ token è™•ç†

## ğŸ› ï¸ æ¸¬è©¦æŠ€è¡“ç‰¹é»

### 1. è³‡æ–™åº«éš”é›¢
- ä½¿ç”¨è¨˜æ†¶é«”å…§ SQLite è³‡æ–™åº« (`:memory:`)
- æ¯å€‹æ¸¬è©¦å®Œå…¨éš”é›¢ï¼Œäº’ä¸å½±éŸ¿
- è‡ªå‹•æ¸…ç†æ¸¬è©¦è³‡æ–™

### 2. Fixtures è¨­è¨ˆ
- `test_app` - æ¸¬è©¦å°ˆç”¨ Flask æ‡‰ç”¨ç¨‹å¼
- `client` - HTTP æ¸¬è©¦å®¢æˆ¶ç«¯
- `test_user` - æ¸¬è©¦ç”¨æˆ¶å»ºç«‹èˆ‡æ¸…ç†
- `auth_headers` - å·²èªè­‰çš„ HTTP headers

### 3. å®‰å…¨æ€§æ¸¬è©¦
- JWT token æ ¼å¼èˆ‡å…§å®¹é©—è­‰
- éæœŸæ™‚é–“æª¢æŸ¥ï¼ˆ8å°æ™‚ï¼‰
- SQL æ³¨å…¥æ”»æ“Šé˜²è­·
- èªè­‰æµç¨‹å®Œæ•´æ€§

## ğŸ“‹ ä½¿ç”¨æ–¹å¼

### å¿«é€ŸåŸ·è¡Œæ¸¬è©¦
```bash
# æ–¹æ³•1ï¼šä½¿ç”¨æä¾›çš„è…³æœ¬ï¼ˆæ¨è–¦ï¼‰
python run_tests.py

# æ–¹æ³•2ï¼šç›´æ¥ä½¿ç”¨ pytest
pytest tests/ -v

# æ–¹æ³•3ï¼šåªåŸ·è¡Œèªè­‰æ¸¬è©¦
pytest tests/test_auth.py -v
```

### ç‰¹å®šæ¸¬è©¦åŸ·è¡Œ
```bash
# åŸ·è¡Œç‰¹å®šæ¸¬è©¦é¡åˆ¥
pytest tests/test_auth.py::TestAuthLogin -v

# åŸ·è¡Œç‰¹å®šæ¸¬è©¦æ–¹æ³•
pytest tests/test_auth.py::TestAuthLogin::test_successful_login -v
```

## ğŸ“Š æ¸¬è©¦çµæœ

```
17 å€‹æ¸¬è©¦æ¡ˆä¾‹å…¨éƒ¨é€šé âœ…
åŸ·è¡Œæ™‚é–“ï¼šç´„ 1 ç§’
æ¸¬è©¦è¦†è“‹ç‡ï¼šèªè­‰ API 100%
```

## ğŸ”§ å®‰è£èˆ‡è¨­å®š

### 1. å®‰è£æ¸¬è©¦ä¾è³´
```bash
# ç¢ºä¿è™›æ“¬ç’°å¢ƒå·²æ¿€æ´»
source venv/bin/activate  # Linux/Mac
venv\Scripts\activate     # Windows

# å®‰è£ä¾è³´ï¼ˆå·²æ·»åŠ åˆ° requirements.txtï¼‰
pip install pytest pytest-flask
```

### 2. åŸ·è¡Œæ¸¬è©¦
```bash
python run_tests.py
```

## ğŸ¯ æˆæœèˆ‡åƒ¹å€¼

### 1. æå‡ç¨‹å¼ç¢¼å“è³ª
- ç¢ºä¿èªè­‰æ©Ÿåˆ¶æ­£ç¢ºé‹ä½œ
- åŠæ—©ç™¼ç¾æ½›åœ¨å•é¡Œ
- ä¿éšœç³»çµ±å®‰å…¨æ€§

### 2. é–‹ç™¼æ•ˆç‡æå‡
- è‡ªå‹•åŒ–å›æ­¸æ¸¬è©¦
- é‡æ§‹æ™‚çš„å®‰å…¨ä¿éšœ
- æŒçºŒæ•´åˆæº–å‚™

### 3. å¯ç¶­è­·æ€§å¢å¼·
- æ¸…æ™°çš„æ¸¬è©¦çµæ§‹
- å®Œæ•´çš„æ–‡æª”èªªæ˜
- æ˜“æ–¼æ“´å±•æ–°æ¸¬è©¦

## ğŸš€ ä¸‹ä¸€æ­¥å»ºè­°

åŸºæ–¼å·²å»ºç«‹çš„æ¸¬è©¦æ¶æ§‹ï¼Œå¾ŒçºŒå¯ä»¥è€ƒæ…®ï¼š

1. **æ“´å±• API æ¸¬è©¦** - ç‚ºå…¶ä»– API ç«¯é»å¢åŠ æ¸¬è©¦
2. **æ•´åˆæ¸¬è©¦** - æ¸¬è©¦å¤šå€‹ API ä¹‹é–“çš„äº¤äº’
3. **æ€§èƒ½æ¸¬è©¦** - æ¸¬è©¦ç³»çµ±åœ¨è² è¼‰ä¸‹çš„è¡¨ç¾
4. **æ¸¬è©¦è¦†è“‹ç‡** - ä½¿ç”¨ pytest-cov ç”Ÿæˆè¦†è“‹ç‡å ±å‘Š

## ğŸ“ æŠ€è¡“èªªæ˜

- **æ¸¬è©¦æ¡†æ¶**ï¼špytest 8.4.1
- **Flask æ¸¬è©¦**ï¼špytest-flask 1.3.0
- **è³‡æ–™åº«**ï¼šSQLite (è¨˜æ†¶é«”)
- **JWT è™•ç†**ï¼šPyJWT 2.10.1
- **å¯†ç¢¼é©—è­‰**ï¼šWerkzeug security

æ­¤æ¸¬è©¦æ¶æ§‹ç‚ºä½ çš„ mq-cms å°ˆæ¡ˆæä¾›äº†å …å¯¦çš„å“è³ªä¿éšœåŸºç¤ï¼Œç¢ºä¿èªè­‰ç³»çµ±çš„å¯é æ€§å’Œå®‰å…¨æ€§ã€‚
