## 2025年7月8日  
### MQ 直立式廣告機內容管理系統 v4.1.0 完成重構

---

### 🚀 新增功能

- **媒體檔案管理系統**：建立完整的檔案生命週期管理功能  
  - `POST /api/media`：前端可上傳圖片、影片等媒體檔案至 Cloudflare R2  
  - `GET /api/media`：從 R2 讀取所有已上傳檔案列表  
  - `DELETE /api/media/[filename]`：刪除 R2 中指定檔案
- **全新管理介面**：`admin.html` 新增檔案上傳表單，並可動態載入、顯示、刪除 R2 檔案列表
- **廣告機輪播功能**：重寫 `display.html`，自動獲取媒體列表，並以輪播方式展示 R2 上的圖片與影片
- **即時播放列表更新**：後端檔案上傳或刪除時，Durable Object 會主動廣播 `playlist_updated` 訊息，所有 `display.html` 頁面即時自動刷新播放內容，無須手動重整

---

### 🛠️ 更新與改進

- **啟用 R2 公開存取**：為 `mq-cms-media` 儲存桶設定公開存取網域（pub-....r2.dev），解決檔案無法從前端讀取的問題，並為媒體播放提供基礎
- **優化後端廣播邏輯**：Durable Object 功能從單純訊息轉發，升級為可由後端 API 觸發的真正伺服器到客戶端（Server-to-Client）推播系統

---

### 🐛 BUG 修復

- **解決頑固的部署失敗問題**：透過重設 Worker、更換名稱、清理本地快取、修正 `wrangler.toml` 中所有名稱的同步，並最終加入 `[[migrations]]` 強制註冊，徹底解決因狀態不同步導致的 `Cannot create binding` 部署錯誤
- **修復無效的上傳**：增加後端日誌進行偵錯，最終定位並解決因 R2 存取權限問題導致的檔案「看似上傳成功，實則未寫入」